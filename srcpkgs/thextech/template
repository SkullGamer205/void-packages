# Template file for 'thextech'
pkgname=thextech
version=1.3.7.2
revision=1
_subversion=1 	      # hotfix
build_style=cmake
configure_args="-DPGE_SHARED_SDLMIXER=OFF -DUSE_SYSTEM_SDL2=ON -DUSE_FREEIMAGE_SYSTEM_LIBS=ON -DCMAKE_INSTALL_PREFIX=/usr -DCMAKE_BUILD_TYPE=MinSizeRel"
hostmakedepends="pkg-config git cmake ninja"
makedepends="SDL2-devel libpng-devel libjpeg-turbo-devel alsa-lib-devel"
depends="SDL2 libjpeg-turbo libpng"
short_desc="Modern C++ port and successor of the SMBX engine"
maintainer="SkullGamer205 <skullgamer205@disroot.org>"
license=GPL-3.0
homepage="wohlsoft.ru/projects/TheXTech"

_ver_subver() {
	echo ${version}$( if [ -n $_subversion ]; then
		echo "-${_subversion}"
	fi )
}
distfiles="https://github.com/TheXTech/TheXTech/releases/download/v$(_ver_subver)/thextech-full-src-v${version}.tar.gz"
checksum=a639c70ea8259a1a0a0345d9614d295aaad8eeca8e6b1752b896930f74ed2404
nopie=yes # Various file managers  recognise it as SO library.

case "$XBPS_TARGET_MACHINE" in
	armv[67]*) configure_args+=" -DAUDIOCODECS_DISABLE_ASM_OPTIMIZATIONS=ON" ;;
esac

post_patch() {
	case "$XBPS_TARGET_MACHINE" in
		armv[67]*)
		msg_normal "Detected ARM architecture ("$XBPS_TARGET_MACHINE")\n"
			for x in ${FILESDIR}/patches/arm-disable-opus.patch; do
				msg_normal "Applying patch $x\n"
				patch -sNp1 -i ${x}
			done
	esac
}

post_install() {
	rm -rf ${DESTDIR}/builddir
}

